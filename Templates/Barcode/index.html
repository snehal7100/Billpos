{% include "Component/header.html" %}
{% include "Component/sidebar.html" %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Print</title>
    <!-- Use Bootstrap 5 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/jsbarcode/3.11.0/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>

    <style>
<<<<<<< HEAD
        
        body {
    font-family: 'Arial', sans-serif;
    background-color: #f4f7fc;
  }

  .container-fluid {
    padding-left: 30px;
    padding-right: 30px;
  }

  .content-wrapper {
    margin-top: 30px;
  }

  table {
    border-radius: 10px;
    overflow: hidden;
    width: 100%;
    background-color: white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
  }

  table th, table td {
    text-align: center;
    padding: 15px;
    font-size: 14px;
  }

  table thead {
    background-color: #343a40;
    color: white;
  }

  table tbody tr {
    background-color: #ffffff;
    transition: background-color 0.3s ease;
  }

  table tbody tr:hover {
    background-color: #f1f1f1;
  }
        
=======
>>>>>>> 9b40261ccb90538c9ac75362c34192650bbeba0b
        .container {
            margin-top: 20px;
        }

        .search-bar {
            margin-bottom: 10px;
        }

        .action-buttons button {
            margin-right: 10px;
        }
<<<<<<< HEAD
=======

        .btn-primary {
            margin-left: 650px;
        }

>>>>>>> 9b40261ccb90538c9ac75362c34192650bbeba0b
        /* Add custom styles for printing */
        @media print {
            body * {
                visibility: hidden;
            }

            #printable-area,
            #printable-area * {
                visibility: visible;
            }

            #printable-area {
                position: absolute;
                left: 0;
                top: 0;
            }
<<<<<<< HEAD
            .card{
                display: flex;
=======

            .product-card {
                width: 200px;
                height: 250px;
                margin: 10px;
                padding: 10px;
                border: 1px solid #ccc;
                text-align: center;
                display: inline-block;
                vertical-align: top;
                box-sizing: border-box;
            }

            .product-card svg {
                margin-top: 10px;
            }

            .product-details {
                font-size: 14px;
                margin-bottom: 5px;
            }

            .product-name {
                font-weight: bold;
            }

            .product-price,
            .product-qty {
                font-size: 12px;
>>>>>>> 9b40261ccb90538c9ac75362c34192650bbeba0b
            }
        }

    </style>
</head>

<body>

    <div class="container-fluid mt-5">
        <div class="content-wrapper">
<<<<<<< HEAD
          
                
=======
>>>>>>> 9b40261ccb90538c9ac75362c34192650bbeba0b

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex align-items-center">
                            <h2>Barcode Print &amp; View</h2>


                            <!-- Add Print Button -->
                            <div class="col-6 px-1">
                                <button id="print-btn" class="btn btn-success btn-block">Print</button>
                            </div>
                        </div>
                        <div class="input-group search-bar">
                            <input type="text" class="form-control" id="search-bar" placeholder="" list="product-list">
                            <datalist id="product-list">
                                {% for product in productData %}
                                <option value="{{ product.pname }}" data-pid="{{ product.pid }}" data-price="{{ product.price }}">
                                    {{ product.pname }} (â‚¹{{ product.price }})
                                </option>
                                {% endfor %}
                            </datalist>
                            <div class="input-group-append">
                                <!-- Button to open the modal -->
                                <button id="search-btn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBrandModal">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="example1_wrapper" class="dataTables_wrapper dt-bootstrap4">

                                <div class="col-sm-12">
                                    <!-- Scrollable Table Container -->

                                    <table id="example1" class="table table-bordered table-striped dataTable dtr-inline" aria-describedby="example1_info">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Item Name</th>
                                                <th>Qty</th>
                                                <th>Mrp</th>
                                                <th>Sale Price</th>
                                                <th>Total</th>
                                                <th>Barcode</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="product-table">
                                            <tr id="empty-row">
                                                <td colspan="7" class="text-center">No products added yet</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- End Scrollable Table Container -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Printable Area (Hidden from print) -->
    <div id="printable-area" style="display: none;">
<<<<<<< HEAD
        <h2>Barcode Print Details</h2>
        <div id="barcodeContainer"></div>
        <table id="product-table-print" class="table">
            
            <tbody id="print-table-body">
                <!-- This will be dynamically populated -->
            </tbody>
        </table>
=======
        <!-- This area will be dynamically populated with product cards -->
>>>>>>> 9b40261ccb90538c9ac75362c34192650bbeba0b
    </div>

    <!-- Modal for Add Product -->
    <div class="modal fade" id="addBrandModal" tabindex="-1" aria-labelledby="addBrandModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 800px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addBrandModalLabel">Add Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="/product-add/" method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
                    {% csrf_token %}
                    <!-- Form content here -->
                </form>
            </div>
        </div>
    </div>

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include Bootstrap 5 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<<<<<<< HEAD
  
<script>
    $(document).ready(function () {
        // Handle Enter key to search and add product to the table
        $("#search-bar").keydown(function (e) {
            if (e.key === "Enter") {
                e.preventDefault(); // Prevent default behavior (form submission)
                
                let productName = $("#search-bar").val();
                let selectedOption = $("#product-list option[value='" + productName + "']");
    
                if (selectedOption.length > 0) {
                    let productId = selectedOption.data("pid");
                    let price = parseFloat(selectedOption.data("price"));
    
                    let tableBody = $("#product-table");
                    let rowCount = $("#product-table tr").length;
    
                    if ($("#empty-row").length) {
                        $("#empty-row").remove(); 
                    }
    
                    let newRow = `<tr>
                                    <td>${rowCount}</td>
                                    <td>${productName}</td>
                                    <td>
                                        <button class="btn btn-sm btn-secondary decrement">-</button>
                                        <input type="text" class="qty-input text-center" value="1" style="width: 40px;" readonly>
                                        <button class="btn btn-sm btn-secondary increment">+</button>
                                    </td>
                                    <td class="price">${price.toFixed(2)}</td>
                                    <td class="sale-price">${price.toFixed(2)}</td>
                                    <td class="total">${price.toFixed(2)}</td>
                                    <td>
                                        <div class="card p-2" style="width: 150px;">
                                            <div class="card-body text-center">
                                                <svg class="barcode" id="barcode-${productId}"></svg>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <button class="btn btn-danger btn-sm delete-row">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                  </tr>`;
    
                    tableBody.append(newRow);
                    $("#search-bar").val(""); // Clear input field
    
                    // Generate barcode for the newly added product after it's in the DOM
                    setTimeout(() => {
                        JsBarcode(`#barcode-${productId}`, productId.toString(), {
                            format: "CODE128",
                            displayValue: true,
                            fontSize: 14,
                            width: 2,
                            height: 50
                        });
                    }, 10);  // Small delay to ensure element is rendered before generating barcode
                } else {
                    alert("Product not found in the list");
                }
            }
        });
    
        // Increment quantity
        $(document).on("click", ".increment", function () {
            let qtyInput = $(this).siblings(".qty-input");
            let qty = parseInt(qtyInput.val()) + 1;
            qtyInput.val(qty);
            updateTotal($(this).closest("tr"));
        });
    
        // Decrement quantity
        $(document).on("click", ".decrement", function () {
            let qtyInput = $(this).siblings(".qty-input");
            let qty = parseInt(qtyInput.val());
            if (qty > 1) {
                qtyInput.val(qty - 1);
                updateTotal($(this).closest("tr"));
            }
        });
    
        // Update total price for a row
        function updateTotal(row) {
            let qty = parseInt(row.find(".qty-input").val());
            let price = parseFloat(row.find(".sale-price").text());
            let total = qty * price;
            row.find(".total").text(total.toFixed(2));
        }
    
        // Delete row functionality
        $(document).on("click", ".delete-row", function () {
            $(this).closest("tr").remove();
            if ($("#product-table tr").length === 0) {
                $("#product-table").append('<tr id="empty-row"><td colspan="7" class="text-center">No products added yet</td></tr>');
            }
        });
    
        // Print functionality for barcode printing
        $("#print-btn").on("click", function () {
    let printContainer = $("#barcodeContainer");
    printContainer.html(""); // Clear previous content
    
    // Iterate over each row in the product table
    $("#product-table tr").each(function () {
        let row = $(this);
        
        // Skip the table header row and any empty rows
        if (row.find("th").length > 0 || row.find("td").length === 0) return;

        let productName = row.find("td:eq(1)").text();
        let qty = row.find(".qty-input").val();
        let price = row.find(".price").text();
        let total = row.find(".total").text();
        let productId = row.find(".barcode").attr("id").split("-")[1];
        
        let newCard = `
    <div class="card p-2 mb-3" style="width: 300px;">
        <div class="card-body text-center">
            
            <p> ${productName}</p>  
            <p>Qty: ${qty}</p>
            <p>Price: â‚¹${price}</p>
            <p>Total: â‚¹${total}</p>
            <svg class="barcode-print" id="print-barcode-${productId}"></svg>
        </div>
    </div>`;

        printContainer.append(newCard);

        // Generate barcode for the print
        setTimeout(() => {
            JsBarcode(`#print-barcode-${productId}`, productId.toString(), {
                format: "CODE128",
                displayValue: true,
                fontSize: 14,
                width: 2,
                height: 50
            });
        }, 50);
    });

    // Hide the table and other elements before printing
    $("#product-table").hide(); // Hide the table
    $("#printable-area").show(); // Show the printable area (only the cards)
    window.print(); // Trigger print dialog
    $("#product-table").show(); // Show the table again after printing
    $("#printable-area").hide(); // Hide the printable area after printing
});
    });
    

</script>
=======

    <script>
        $(document).ready(function () {
            $("#search-bar").keydown(function (e) {
                if (e.key === "Enter") {
                    e.preventDefault(); 
                    let productName = $("#search-bar").val();
                    let selectedOption = $("#product-list option[value='" + productName + "']");

                    if (selectedOption.length > 0) {
                        let productId = selectedOption.data("pid");
                        let price = parseFloat(selectedOption.data("price")); // Convert to number

                        let tableBody = $("#product-table");
                        let rowCount = $("#product-table tr").length;

                        if ($("#empty-row").length) {
                            $("#empty-row").remove(); 
                        }

                        let newRow = `<tr>
                                        <td>${rowCount}</td>
                                        <td>${productName}</td>
                                        <td>
                                            <button class="btn btn-sm btn-secondary decrement">-</button>
                                            <input type="text" class="qty-input text-center" value="1" style="width: 40px;" readonly>
                                            <button class="btn btn-sm btn-secondary increment">+</button>
                                        </td>
                                        <td class="price">${price.toFixed(2)}</td>
                                        <td class="sale-price">${price.toFixed(2)}</td>
                                        <td class="total">${price.toFixed(2)}</td>
                                        <td>
                                            <div class="card p-2" style="width: 150px;">
                                                <div class="card-body text-center">
                                                    <svg class="barcode" id="barcode-${productId}"></svg>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm delete-row">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>`;

                        tableBody.append(newRow);
                        $("#search-bar").val(""); // Clear input

                        // Generate barcode for the newly added product after it's in the DOM
                        setTimeout(() => {
                            JsBarcode(`#barcode-${productId}`, productId.toString(), {
                                format: "CODE128",
                                displayValue: true,
                                fontSize: 14,
                                width: 2,
                                height: 50
                            });
                        }, 10);  // Adding a small delay to ensure the element is fully rendered before barcode generation
                    }
                }
            });

            // Quantity increment
            $(document).on("click", ".increment", function () {
                let qtyInput = $(this).siblings(".qty-input");
                let qty = parseInt(qtyInput.val()) + 1;
                qtyInput.val(qty);
                updateTotal($(this).closest("tr"));
            });

            // Quantity decrement
            $(document).on("click", ".decrement", function () {
                let qtyInput = $(this).siblings(".qty-input");
                let qty = parseInt(qtyInput.val());
                if (qty > 1) {
                    qtyInput.val(qty - 1);
                    updateTotal($(this).closest("tr"));
                }
            });

            // Function to update total price
            function updateTotal(row) {
                let qty = parseInt(row.find(".qty-input").val());
                let price = parseFloat(row.find(".sale-price").text());
                let total = qty * price;
                row.find(".total").text(total.toFixed(2));
            }

            // Delete row functionality
            $(document).on("click", ".delete-row", function () {
                $(this).closest("tr").remove();
                if ($("#product-table tr").length === 0) {
                    $("#product-table").append('<tr id="empty-row"><td colspan="7" class="text-center">No products added yet</td></tr>');
                }
            });

            // Print functionality
            $("#print-btn").on("click", function () {
                let printArea = $("#printable-area");
                printArea.html(""); // Clear previous content

                // Create each product card
                $("#product-table tr").each(function () {
                    let row = $(this);
                    
                    // Get product data
                    let productName = row.find("td:eq(1)").text();
                    let qty = row.find(".qty-input").val();
                    let price = row.find(".sale-price").text();
                    let total = row.find(".total").text();
                    let productId = row.find(".barcode").attr("id").split("-")[1];

                    // Create the product card HTML
                    let productCard = `<div class="product-card">
                                        <div class="product-name">${productName}</div>
                                        <div class="product-details">Qty: ${qty}</div>
                                        <div class="product-details">Price: â‚¹${price}</div>
                                        <div class="product-details">Total: â‚¹${total}</div>
                                        <svg class="barcode" id="barcode-${productId}"></svg>
                                    </div>`;

                    // Append product card to the printable area
                    printArea.append(productCard);

                    // Generate barcode for the product
                    setTimeout(() => {
                        JsBarcode(`#barcode-${productId}`, productId.toString(), {
                            format: "CODE128",
                            displayValue: true,
                            fontSize: 14,
                            width: 2,
                            height: 50
                        });
                    }, 100);  // Delay to ensure the element is fully rendered
                });

                // Show the printable area and trigger the print dialog
                printArea.show();
                window.print();
                printArea.hide();
            });
        });
    </script>
>>>>>>> 9b40261ccb90538c9ac75362c34192650bbeba0b

</body>

</html>
{% include "Component/footer.html" %}
