
{% include "Component/Header.html" %}
{% include "Component/Sidebar.html" %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POS System</title>
  <!-- AdminLTE CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>


    .fixed-summary-bar {
      position: fixed; /* Keep the bar fixed at the bottom */
      bottom: 0; /* Align it just above the footer */
      left: 0;
      right: 0;
      width: 100%; /* Match the full width of the content */
      background: #f8f9fa; /* Match your content-wrapper's background */
      border-top: 1px solid #dee2e6; /* Add a subtle border */
      display: flex;
      justify-content: space-between; /* Space out the sections evenly */
      align-items: center; /* Vertically center the content */
      padding: 10px 20px; /* Add padding for better spacing */
      font-weight: bold; /* Highlight the text */
      z-index: 1050; /* Ensure it stays above other elements */
      box-shadow: 0px -2px 5px rgba(0, 0, 0, 0.1); /* Add a shadow for depth */
    }
    
    .fixed-summary-bar div {
      text-align: center; /* Center-align the text in each section */
      flex: 1; /* Distribute equal space */
      margin: 0 10px; /* Add spacing between the sections */
    }
    

    .content-wrapper {
      background-color: #f8f9fa;
      padding: 20px;
    }
    .card {
      background-color: #fff;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
    }
    .total-amount {
      font-size: 2.5rem;
      font-weight: bold;
      color: #ff5722;
      text-align: center;
      margin: 15px 0;
    }
    .btn-block {
      width: 100%;
    }


    td > .btn-group {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    td > .btn-group .btn {
      margin: 0 2px; /* Optional for slight spacing */
      flex: 0 0 auto;
    }
    
    .quantity {
      margin: 0 5px;
      display: inline-block;
      min-width: 20px; /* Ensures number stays aligned */
      text-align: center;
    }
    

    .fixed-summary-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fff;
      border-top: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      padding: 10px 20px;
      font-weight: bold;
      z-index: 1050;
    }
    .fixed-summary-bar div {
      text-align: center;
      flex: 1;
    }
    .input-group {
      display: flex;
      align-items: stretch;
      width: 100%;
      max-width: 600px;
      margin: auto;
    }
    #search-bar {
      flex: 1;
      border: 1px solid #dee2e6;
      border-radius: 4px 0 0 4px;
      height: calc(2.375rem + 2px);
      padding: 0.5rem;
    }
    #search-btn {
      border: 1px solid #dee2e6;
      border-left: none;
      border-radius: 0 4px 4px 0;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      padding: 0 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      height: calc(2.375rem + 2px);
    }
    #search-btn:hover {
      background-color: #0056b3;
    }

    .fixed-summary-bar {
      position: absolute;
      bottom: 20px; /* Adjusted from fixed to absolute */
      left: 0;
      right: 0;
      width: auto;
      background: #fff;
      border-top: 1px solid #dee2e6;
      display: flex;
      justify-content: center; /* Center the summary bar */
      padding: 10px 20px;
      font-weight: bold;
      z-index: 1050;
      box-shadow: 0px -2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .fixed-summary-bar div {
      text-align: center;
      margin: 0 10px; /* Add spacing between the summary sections */
      flex: 1;
      padding: 0 10px; /* Ensure space between each section */
    }
    
  </style>
</head>
<body class="hold-transition sidebar-mini">
  <div class="wrapper">
    <div class="content-wrapper">
      <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3>POS System</h3>
          <div>
            <button class="btn btn-danger" onclick="window.location.href='/dashboard/'">Dashboard</button>

            <button class="btn btn-primary">POS Bills List</button>
          </div>
        </div>
        <div class="row">
          <div class="col-md-7">
            <div class="card">
              <div class="card-body">
                <div class="input-group mb-3">
                  <input type="text" id="search-bar" class="form-control mb-3" placeholder="Search Products by name or Scan Barcode..." list="product-list">
                  <datalist id="product-list">
                    {% for product in productData %}
                      <option value="{{ product.pname }}" data-pid="{{ product.pid }}" data-price="{{ product.price }}">
                        {{ product.pname }} (₹{{ product.price }})
                      </option>
                    {% endfor %}
                  </datalist>
                  <button id="search-btn" class="btn btn-primary"><i class="fa fa-plus"></i></button>
                </div>
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>No.</th>
                      <th>Item Name</th>
                      <th>Qty</th>
                      <th>Mrp</th>
                      <th>Sale Price</th>
                      <th>Total</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="product-table">
                    <tr id="empty-row">
                      <td colspan="7">No products available</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-md-5">
            <div class="card customer-details">
              <label for="customer" class="form-label">Customer:</label>
              <select class="form-control mb-2" id="customer" name="customer">
                <option value="" disabled selected>Select customer</option>
                {% for customer in customerData %}
                  <option 
                    value="{{ customer.id }}" 
                    data-mobile="{{ customer.mobile_no }}" 
                    data-address="{{ customer.billing_address }}" 
                    data-credit_limit="{{ customer.credit_limit }}">
                    {{ customer.name }}
                  </option>
                {% endfor %}
              </select>
              
              <p><strong>Mobile No:</strong> <span id="mobile-no">N/A</span></p>
              <p><strong>Address:</strong> <span id="address">N/A</span></p>
              <p><strong>Credit Amt:</strong> <span id="credit_limit">N/A</span></p>
              <p><strong>Payment Term:</strong>
                <select class="form-control mb-2">
                  <option>Cash</option>
                  <option>Credit</option>
                </select>
              </p>
              <p><strong>Total:</strong> ₹<span id="bill-total">1045</span></p>

              <p><strong>Remaining Amt:</strong> ₹0</p>
              <p><strong>Bill Date:</strong> <input type="date" class="form-control" value="2024-12-27"></p>
            </div>
            <div class="card bill-details">
              <h5>Bill Details</h5>
              <div class="total-amount">₹1045</div>
              <div class="row">
                <div class="col-6 px-1">
                  <button class="btn btn-primary btn-block">Save Bill</button>
                </div>
                <div class="col-6 px-1">
                  <button class="btn btn-secondary btn-block">Clear</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
     <div class="fixed-summary-bar">
    <div>Last Bill: 5 | Amt: ₹89</div>
    <div>Total Qty: <span id="total-quantity">0</span></div>
    <div>Total MRP: ₹500.00</div>
    <div>Total Discount: ₹-545.00</div>
    <div>Total Bill: ₹1045</div>
  </div>
  </div>
  <script>
    document.getElementById('customer').addEventListener('change', function () {
      const selectedOption = this.options[this.selectedIndex];
      const mobileNo = selectedOption.getAttribute('data-mobile') || 'N/A';
      const address = selectedOption.getAttribute('data-address') || 'N/A';
      const creditLimit = selectedOption.getAttribute('data-credit_limit') || 'N/A';
  
      document.getElementById('mobile-no').textContent = mobileNo;
      document.getElementById('address').textContent = address;
      document.getElementById('credit_limit').textContent = creditLimit;
    });
  
    function saveToLocalStorage() {
      const productRows = document.querySelectorAll('#product-table tr:not(#empty-row)');
      const products = Array.from(productRows).map((row) => {
        return {
          id: row.id.replace('product-', ''),
          name: row.children[1].textContent,
          quantity: parseInt(row.querySelector('.quantity').textContent, 10),
          price: parseFloat(row.children[3].textContent.replace('₹', '')),
        };
      });
      localStorage.setItem('products', JSON.stringify(products));
    }
  
<<<<<<< HEAD
    function loadFromLocalStorage() {
      const productData = JSON.parse(localStorage.getItem('products')) || [];
      const productTable = document.getElementById('product-table');
      const emptyRow = document.getElementById('empty-row');
  
      productData.forEach((product, index) => {
        const row = document.createElement('tr');
        row.id = `product-${product.id}`;
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${product.name}</td>
          <td>
            <div class="btn-group">
              <button class="btn btn-sm btn-secondary decrement">-</button>
              <span class="quantity">${product.quantity}</span>
              <button class="btn btn-sm btn-secondary increment">+</button>
            </div>
          </td>
          <td>₹${product.price.toFixed(2)}</td>
          <td>₹${product.price.toFixed(2)}</td>
          <td>₹${(product.quantity * product.price).toFixed(2)}</td>
          <td>
            <button class="btn btn-sm btn-danger remove">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        productTable.appendChild(row);
  
        row.querySelector('.increment').addEventListener('click', () => updateQuantity(row, 1));
        row.querySelector('.decrement').addEventListener('click', () => updateQuantity(row, -1));
        row.querySelector('.remove').addEventListener('click', () => {
          row.remove();
          saveToLocalStorage();
          calculateTotals();
        });
  
        if (emptyRow) emptyRow.remove();
      });
  
      calculateTotals(); // Recalculate totals after loading
    }
=======
    // Function to load data from localStorage
    // Function to load data from localStorage
function loadFromLocalStorage() {
  const productData = JSON.parse(localStorage.getItem('products')) || [];
  const productTable = document.getElementById('product-table');
  const emptyRow = document.getElementById('empty-row');

  productData.forEach((product, index) => {
    const row = document.createElement('tr');
    row.id = `product-${product.id}`;
    row.innerHTML = `
      <td>${index + 1}</td>
      <td>${product.name}</td>
      <td>
        <div class="btn-group">
          <button class="btn btn-sm btn-secondary decrement">-</button>
          <span class="quantity">${product.quantity}</span>
          <button class="btn btn-sm btn-secondary increment">+</button>
        </div>
      </td>
      <td>₹${product.price.toFixed(2)}</td>
      <td>₹${product.price.toFixed(2)}</td>
      <td>₹${(product.quantity * product.price).toFixed(2)}</td>
      <td>
        <button class="btn btn-sm btn-danger remove">
          <i class="fas fa-trash"></i>
        </button>
      </td>
    `;
    productTable.appendChild(row);

    // Add event listeners
    row.querySelector('.increment').addEventListener('click', () => updateQuantity(row, 1));
    row.querySelector('.decrement').addEventListener('click', () => updateQuantity(row, -1));

    // Add the event listener for the delete button after the row is added
    row.querySelector('.remove').addEventListener('click', () => {
      // Show confirmation dialog
      const confirmDelete = confirm("Are you sure you want to delete this product?");
      if (confirmDelete) {
        row.remove(); // Remove the product row
        saveToLocalStorage(); // Save updated data to localStorage
        calculateTotals(); // Recalculate totals
      }
    });

    if (emptyRow) emptyRow.remove();
  });

  calculateTotals(); // Recalculate totals after loading
}

>>>>>>> 78ffe16f4a9096ea8db1da84398c34386b30a50f
  
    function calculateTotals() {
      const productRows = document.querySelectorAll('#product-table tr:not(#empty-row)');
      let total = 0;
      let totalQty = 0;
  
      productRows.forEach((row) => {
        const totalCell = row.children[5]; // Total price column
        const quantityCell = row.querySelector('.quantity'); // Quantity column
  
        if (totalCell) {
          total += parseFloat(totalCell.textContent.replace('₹', '')) || 0;
        }
        if (quantityCell) {
          totalQty += parseInt(quantityCell.textContent, 10) || 0;
        }
      });
  
      // Update the total amount fields
      document.querySelector('.total-amount').textContent = `₹${total.toFixed(2)}`;
      document.querySelectorAll('.fixed-summary-bar div')[4].textContent = `Total Bill: ₹${total.toFixed(2)}`;
      document.getElementById('bill-total').textContent = total.toFixed(2);
  
      // Update the total quantity field
      document.getElementById('total-quantity').textContent = totalQty;
  
      // Save updated totals to localStorage
      localStorage.setItem('total', total.toFixed(2));
      localStorage.setItem('totalQty', totalQty);
    }
  
    document.getElementById('search-btn').addEventListener('click', function () {
      const searchBar = document.getElementById('search-bar');
      const productTable = document.getElementById('product-table');
      const emptyRow = document.getElementById('empty-row');
  
      const query = searchBar.value.toLowerCase().trim();
      const productOption = Array.from(document.querySelectorAll('#product-list option')).find(
        (option) => option.value.toLowerCase() === query
      );
  
      if (productOption) {
        const pid = productOption.getAttribute('data-pid');
        const pname = productOption.value;
        const price = parseFloat(productOption.getAttribute('data-price'));
  
        let existingRow = Array.from(productTable.children).find(
          (row) => row.id === `product-${pid}` && row.querySelector('td:nth-child(2)').textContent === pname
        );
  
        if (existingRow) {
          updateQuantity(existingRow, 1);
        } else {
          const currentRowCount = productTable.querySelectorAll('tr').length;
          let row = document.createElement('tr');
          row.id = `product-${pid}`;
          row.innerHTML = `
            <td>${currentRowCount}</td>
            <td>${pname}</td>
            <td>
              <div class="btn-group">
                <button class="btn btn-sm btn-secondary decrement">-</button>
                <span class="quantity">1</span>
                <button class="btn btn-sm btn-secondary increment">+</button>
              </div>
            </td>
            <td>₹${price.toFixed(2)}</td>
            <td>₹${price.toFixed(2)}</td>
            <td>₹${price.toFixed(2)}</td>
            <td>
              <button class="btn btn-sm btn-danger remove">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          `;
          productTable.appendChild(row);
  
          row.querySelector('.increment').addEventListener('click', () => updateQuantity(row, 1));
          row.querySelector('.decrement').addEventListener('click', () => updateQuantity(row, -1));
          row.querySelector('.remove').addEventListener('click', () => {
            row.remove();
            saveToLocalStorage();
            calculateTotals();
          });
  
          if (emptyRow) emptyRow.remove();
        }
  
        saveToLocalStorage(); // Save data to localStorage
        calculateTotals(); // Recalculate totals
      } else {
        alert('Product not found!');
      }
  
      searchBar.value = '';
    });
  
    function updateQuantity(row, delta) {
      const quantitySpan = row.querySelector('.quantity');
      let quantity = parseInt(quantitySpan.textContent, 10);
      quantity = Math.max(1, quantity + delta);
      quantitySpan.textContent = quantity;
  
      const price = parseFloat(row.children[3].textContent.replace('₹', ''));
      row.children[5].textContent = `₹${(quantity * price).toFixed(2)}`;
  
      saveToLocalStorage(); // Save data to localStorage
      calculateTotals(); // Recalculate totals
    }
  
    document.addEventListener('DOMContentLoaded', loadFromLocalStorage);
  </script>
   
       
  <!-- AdminLTE JS -->
  <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
</body>
</html>
{% include "Component/Footer.html" %}

